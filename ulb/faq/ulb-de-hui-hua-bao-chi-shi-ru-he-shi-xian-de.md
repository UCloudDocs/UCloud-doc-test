# ULB的会话保持是如何实现的？

会话保持是ULB提供的高级功能，可以在轮询等负载均衡算法下，保证来自同一个客户端的请求，能够被后端同一个服务节点处理。

* 请求代理模式下，会话保持功能是利用cookie实现的。ULB会向源端写cookie，并根据请求带有的cookie信息，直接将请求送给对应的后端主机。服务端插入指, 由负载均衡生成cookie的key. 用户定义指由用户指定特征cookie的key.
* 报文转发模式下，会话保持功能是基于连接表实现的。





#### 会话保持

针对HTTP协议、HTTPS协议（七层服务）ULB基于Cookie支持会话保持功能。用户在配置时可以选择开启会话保持功能。会话保持支持两种方式：

**Cookie插入**：选择自动生成key，客户端的cookie插入操作都由ULB来分配和管理。

**用户指定Cookie插入**：用户可自定义key，ULB使用客户的key来分配和管理对客户端进行的Cookie插入操作

针对TCP协议的报文转发模式或UDP协议时（四层服务），是基于IP地址的会话保持。ULB会将来自同一IP地址的访问请求转发到同一台后端云服务器进行处理。

TCP协议的请求代理模式，不支持会话保持。

